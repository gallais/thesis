\chapter{Discussion}

\section{Summary}

We have demonstrated that we can exploit the shared structure highlighted by the
introduction of \AR{Semantics} to further alleviate the implementer's pain by
tackling the properties of these \AR{Semantics} in a similarly abstract approach.

We characterised, using a first logical relation, the traversals which were
producing related outputs provided they were fed related inputs. We then provided
useful instances of this schema thus proving that syntactic traversals are
extensional, that renaming is a special case of substitution or even that
normalisation by evaluation produces equal normal forms provided \AF{PER}-related
evaluation environments.

A more involved second logical relation gave us a general description of fusion
of traversals where we study triples of semantics such that composing the two
first ones would yield an instance of the third one. We then saw that the four
lemmas about the possible interactions of pairs of renamings and/or substitutions
are all instances of this general framework and can be proven sequentially, the
later results relying on the former ones. We then went on to proving the
substitution lemma for Normalisation by Evaluation.

\section{Related Work}

Benton, Hur, Kennedy and McBride's joint work~(\citeyear{benton2012strongly}) was not
limited to defining traversals. They proved fusion lemmas describing the interactions
of renaming and substitution using tactics rather than defining a generic proof framework
like we do. They have also proven the evaluation function of their denotational semantics
correct; however they chose to use propositional equality and to assume function
extensionality rather than resorting to the traditional Partial Equivalence Relation
approach we use.

Through the careful study of the recursion operator associated to each strictly positive
datatype, Malcolm defined proof principles (\cite{DBLP:journals/scp/Malcolm90}) which can
be also used as optimisation principles, just like our fusion principles. Other
optimisations such as deforestation (\cite{wadler1990deforestation}) or transformation
to an equivalent but tail-recursive program (\cite{TomeCortinas:2018:AAM:3240719.3241787})
have seen a generic treatment.


\section{Further work}

We have now fulfilled one of the three goals we highlighted in
\cref{chapter:program-conclusion}. The question of finding more instances of
\AR{Semantics} and of defining a generic notion of \AR{Semantics} for all
syntaxes with binding is still open. Analogous questions for the proof
frameworks arise naturally.


\subsection{Other Instances}

We have only seen a handful of instances of both the \AR{Simulation} lemma and
the \AR{Fusion} one. They already give us important lemmas when studying the
meta-theory of a language. However there are potential opportunities for more
instances to be defined.

We would like to know whether the idempotence of normalisation by evaluation
can be proven as a corollary of a fusion lemma for evaluation. This would give
us a nice example of a case where the \ARF{reify·¥¨} is not the identity and
actually does some important work.

Another important question is whether it is always possible to fuse a
preliminary syntactic traversal followed by a semantics \AB{ùì¢} into
a single pass of \AB{ùì¢}.

\subsection{Other Proof Frameworks}

After implementing \AR{Simulation} and \AR{Fusion}, we can wonder whether there
are any other proof schemas we can make formal.

As we have explained in \cref{sec:simulationrel}, \AR{Simulation} gives the
\emph{relational} interpretation of evaluation. Defining a similar framework
dealing with a single semantics would give us the \emph{predicate} interpretation
of evaluation. This would give a generalisation of the fundamental lemma of logical
predicates which, once specialised to substitution, would be exactly the traditional
definition one would expect.

Another possible candidate is an \AR{Identity} framework which would, provided that some
constraints hold of the values in the environment, an evaluation is the identity. So far
we have only related pairs of evaluation results but to prove an identity lemma we would
need to relate the evaluation of a term to the original term itself. Although seemingly
devoid of interest, identity lemmas are useful in practice both when proving or when
optimising away useless traversals.

We actually faced these two challenges when working on the POPLMark Reloaded challenge
(\cite{poplmark2}). We defined the proper generalisation of the fundamental lemma of
logical predicates but could only give ad-hoc identity lemmas for renaming (and thus
substitution because they are in simulation).

\subsection{Generic Proof Frameworks}

In the next part, we are going to define a universe of syntaxes with binding and a generic
notion of semantics over these syntaxes. We naturally want to be able to also prove generic
results about these generic traversals. We are going to have to need to generalise the proof
frameworks to make them syntax generic.
